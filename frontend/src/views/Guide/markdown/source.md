大批量的图像一般是从一些来源网站上获取的，而管理这些图像往往费时费力。来源数据管理功能可以为图像标记其来源，结合其来源数据，实现各种便利的功能。

## 站点

在使用来源数据管理之前，首先需要定义好要使用的站点(Site)。在「设置」-「元数据」-「来源站点」，可以添加新的来源站点定义。

站点有如下属性：
* **站点名称**: 用于唯一确定一个站点的名称，不可更改。
* **站点显示名称**: 在各个位置显示站点时所展示的名称。
* **启用二级分页**: 此站点所属的来源数据启用「分页」。
* **启用分页页名**: 此站点所属的来源数据允许使用「分页页名」。
* **可用元数据字段**: 该站点允许使用的附加信息。此处可以定义每个信息字段的唯一定位名称和显示名称。
* **链接自动生成规则**: 来源数据是有链接这一选项的，而此规则可以自动生成链接，不需要手动填写。  
    ```
    https://pixiv.net/artworks/$id      //=> $id会被替换为来源数据ID
    https://e-hentai.org/g/$id/$token   //=> $token这类其他变量则会被替换为附加信息中的字段
    ```

## 来源ID、分页与页名

有了站点之后，就可以编写新的来源数据了。在主菜单「来源数据」页，可以查看确认所有的来源数据。

来源数据的构成是**站点+ID**，即一个站点下的每一个ID对应唯一的一条来源数据，也即来源数据是以ID为单位来管理的。_ID只能是一个由字母、数字组成的字符串，且它**区分大小写**，但当ID由纯数字构成时，它也会被视作纯数字ID，并在后续操作(例如排序)中得到优化。_

当来源数据附加到图像上时，它的构成多了一些，为**站点+ID+分页+页名**。对于没有开启「二级分页」的站点，图像直接对应了一个来源ID；对于开启了「二级分页」的站点，图像则对应了一个来源ID下的一个分页(Page)。分页只能是一个非负整数。

页名(Page Name)则是开启了「分页页名」后的一个额外属性。有一些站点的分页还有一些额外的唯一定位标识符，或者不靠页码顺序做唯一定位，此时则可以使用页名替代作为唯一定位。

> 例如，Danbooru的每个post拥有全局唯一ID，且每个post有自己的标签，它适合站点+ID定位；  
> Pixiv的每个artwork都可能有多页，它适合站点+ID+分页；  
> E-Hentai的每个gallery都有多页，但它的每个图像也有唯一ID、可能重复、可能变换顺序，它适合站点+ID+分页页名。

## 来源数据

在「来源数据」页，或图像的「来源数据」侧边栏，可以编辑来源数据。一条来源数据可以拥有以下属性：
* **标题**: 来源项的标题。
* **描述**: 来源项的描述。
* **标签**: 来源项的标签项，可以类比元数据标签。
* **集合**: 来源项的集合项，可以类比画集。
* **关联项**: 来源项关联的其他项的ID，可以类比关联组。
* **链接**: 来源项的站点链接。链接可以依靠自动生成规则来生成。
* **附加信息**: 来源项的附加信息。附加信息需要在站点设置中设定才能编写。

来源数据的标签和集合是有着较高复杂度的两项属性。
* 来源标签有“**标识编码**”和“**类型**”属性，这两者结合唯一标识一个标签。编辑标签时，只要标识编码&类型未变，编辑的就是同一个对象。相应的，只要修改标识编码&类型，就会被认为是另一个对象了。
* 来源集合有“**标识编码**”属性，它唯一标识一个集合。编辑集合时，只要标识编码未变，编辑的就是同一个对象。相应的，只要修改标识编码，就会被认为是另一个对象了。
* 除此以外的其他属性都是可选的。只要不改动，就不会修改此对象的属性；添加一个新标签/集合时，完全可以只写编码，这会沿用已有的对象而不会清空它的属性。

在来源数据的详情面板，还可以看到「编写状态」一项，用来标记区分不同编写需要的来源数据。它有如下几种状态：
* 未编辑(NOT_EDITED): 还没有填写来源数据。
* 已编辑(EDITED): 已经填写了来源数据。
* 错误(ERROR): 来源数据的填写发生了错误。多用于外部导入时发生了错误。
* 忽略(IGNORED): 忽略词条来源数据的填写。多用于外部导入时跳过。

在编辑来源数据的内容时，编写状态会自动改变，当然也可以手动改变其状态。

### 数据从哪里来?

可以发现，来源数据管理的内容更多是提供了一个编写框架。来源ID可以从文件名生成，其实际内容仍然需要靠编写。

Hedge本体并没有提供任何来源数据内容获取工具，相关内容的获取仍然需要依赖外部工具。相关工具需求，可以参考**Hedge Command Line Application**与**Hedge Chrome Extension**项目。